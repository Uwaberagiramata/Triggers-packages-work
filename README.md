# Triggers-packages-work
Question 1 and question 2 
---
**Course:** Database Development with PL/SQL (INSY 8311)   
**Institution**: Adventist University of Central Africa (AUCA)  
**Instructor**: Eric Maniraguha  
**Assignment**: GroupAssignment II 
**Submission Date**: November 26, 2025

## ðŸ‘¨â€ðŸ’» Team Members
- **Baziga Nkuranga caleb : 28845**  
- **Arizewe jeniffer id**  
- **Uwabera Giramata Sheilla : 28741.**  
- **Gasana Gerardine :28888**  
- **Sabin Izere patience ID: 27816**  
- **Muneza PRINCE ISHIMWE id: 27816**

---
ðŸ” Login Security Monitoring System

A lightweight database-level security mechanism designed to detect suspicious login activity and automatically generate alerts when users exceed safe login attempt limits.

ðŸš€ What This System Does

Tracks all login attempts (successful + failed) through a login_audit table.

Automatically detects repeated failed logins using a database trigger.

Generates security alerts when a user fails more than two times in the same session/day.

(Optional) Sends email notifications to the security team for fast response.

ðŸŽ¯ Why It Matters

Prevents brute-force and credential-guessing attacks.

Provides clear auditing for all login activity.

Automates early warning signals without needing external tools.

Strengthens overall system security with minimal overhead.

ðŸ§© How It Works

App inserts each login attempt into login_audit.

Trigger checks the userâ€™s failed attempts for the day.

If failed attempts > 2 â†’ system inserts a record into security_alerts.

 A procedure sends out an alert email.

âœ” Expected Behavior

1â€“2 failed attempts: only logged.

3+ failed attempts: security alert triggered and recorded.


**Queries used and output displayed**
---

------------------------------------------------------------
-- 1. LOGIN AUDIT TABLE
------------------------------------------------------------
CREATE TABLE login_audit (
    audit_id      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username      VARCHAR2(50) NOT NULL,
    attempt_time  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status        VARCHAR2(10) CHECK (status IN ('SUCCESS', 'FAILED')),
    ip_address    VARCHAR2(100)
);
![table 1](https://github.com/user-attachments/assets/f3be4528-bf36-409e-abfe-b258583f948a)


------------------------------------------------------------
-- 2. SECURITY ALERTS TABLE
------------------------------------------------------------
CREATE TABLE security_alerts (
    alert_id        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username        VARCHAR2(50) NOT NULL,
    failed_attempts NUMBER NOT NULL,
    alert_time      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    alert_message   VARCHAR2(255),
    contact_email   VARCHAR2(100)
);
![table security](https://github.com/user-attachments/assets/d17c5dbf-04fa-4618-8fd0-807602cec055)


------------------------------------------------------------
-- 3. EMAIL PROCEDURE (SIMULATION)
------------------------------------------------------------
CREATE OR REPLACE PROCEDURE send_security_email(
    p_username        VARCHAR2,
    p_failed_attempts NUMBER
)
IS
BEGIN
    DBMS_OUTPUT.PUT_LINE(
        'SIMULATED EMAIL: User ' || p_username ||
        ' has ' || p_failed_attempts || ' failed login attempts!'
    );
END;
/
![procedure](https://github.com/user-attachments/assets/48e8628f-4a5f-4662-af2c-2f3656073e57)

------------------------------------------------------------
-- 4. TRIGGER TO DETECT FAILED LOGINS & INSERT ALERTS
------------------------------------------------------------
CREATE OR REPLACE TRIGGER trg_failed_login_alert
FOR INSERT ON login_audit
COMPOUND TRIGGER

    TYPE t_usernames IS TABLE OF VARCHAR2(50);
    v_usernames t_usernames := t_usernames();

    BEFORE EACH ROW IS
    BEGIN
        IF :NEW.status = 'FAILED' THEN
            v_usernames.EXTEND;
            v_usernames(v_usernames.LAST) := :NEW.username;
        END IF;
    END BEFORE EACH ROW;

    AFTER STATEMENT IS
        v_failed_count NUMBER;
    BEGIN
        FOR i IN 1 .. v_usernames.COUNT LOOP
            SELECT COUNT(*)
            INTO v_failed_count
            FROM login_audit
            WHERE username = v_usernames(i)
              AND status = 'FAILED'
              AND TRUNC(attempt_time) = TRUNC(SYSDATE);

            IF v_failed_count > 2 THEN
                INSERT INTO security_alerts (
                    username,
                    failed_attempts,
                    alert_message,
                    contact_email
                ) VALUES (
                    v_usernames(i),
                    v_failed_count,
                    'Suspicious login activity detected: more than 2 failed attempts.',
                    'security@company.com'
                );
            END IF;
        END LOOP;
    END AFTER STATEMENT;

END trg_failed_login_alert;
/
![creating triggerr](https://github.com/user-attachments/assets/94788b52-7b52-4ac0-b77c-2717bcd2ac1f)

------------------------------------------------------------
-- 5. TRIGGER TO SEND EMAIL AFTER ALERT
------------------------------------------------------------
CREATE OR REPLACE TRIGGER trg_print_email_notification
AFTER INSERT ON security_alerts
FOR EACH ROW
BEGIN
    send_security_email(:NEW.username, :NEW.failed_attempts);
END;
/
![output](https://github.com/user-attachments/assets/b63c360c-bccb-4060-88a2-18fbf9df55e6)

